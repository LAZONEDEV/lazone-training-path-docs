"use strict";(self.webpackChunklazone_learning_path=self.webpackChunklazone_learning_path||[]).push([[15],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),u=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=u(e.components);return r.createElement(p.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,k=c["".concat(p,".").concat(m)]||c[m]||d[m]||l;return n?r.createElement(k,i(i({ref:t},s),{},{components:n})):r.createElement(k,i({ref:t},s))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[c]="string"==typeof e?e:a,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6045:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const l={},i="04 - D\xe9ployer une application Next.js avec Docker",o={unversionedId:"fullstack-learning-path/module-2/nextjs-docker-app",id:"fullstack-learning-path/module-2/nextjs-docker-app",title:"04 - D\xe9ployer une application Next.js avec Docker",description:"Ce chapitre explique comment containeriser et d\xe9ployer une application Next.js \xe0 l\u2019aide de Docker. Tu apprendras \xe0 cr\xe9er une image Docker optimis\xe9e, \xe0 lancer un conteneur et \xe0 pr\xe9parer ton application pour la production.",source:"@site/docs/fullstack-learning-path/module-2/04-nextjs-docker-app.md",sourceDirName:"fullstack-learning-path/module-2",slug:"/fullstack-learning-path/module-2/nextjs-docker-app",permalink:"/lazone-training-path-docs/docs/next/fullstack-learning-path/module-2/nextjs-docker-app",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/fullstack-learning-path/module-2/04-nextjs-docker-app.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Metadata API dans NextJS 15 : Guide complet",permalink:"/lazone-training-path-docs/docs/next/fullstack-learning-path/module-2/metadata-api"},next:{title:"Module 3: Architecture et \xe9tat global",permalink:"/lazone-training-path-docs/docs/next/category/module-3-architecture-et-\xe9tat-global"}},p={},u=[{value:"Objectifs d&#39;apprentissage",id:"objectifs-dapprentissage",level:2},{value:"Voir aussi",id:"voir-aussi",level:2},{value:"1. Pourquoi Docker pour Next.js ?",id:"1-pourquoi-docker-pour-nextjs-",level:2},{value:"Avantages :",id:"avantages-",level:3},{value:"2. Pr\xe9parer ton application Next.js",id:"2-pr\xe9parer-ton-application-nextjs",level:2},{value:"3. Dockerfile : cr\xe9er l\u2019image Docker",id:"3-dockerfile--cr\xe9er-limage-docker",level:2},{value:"4. Construire et lancer le conteneur",id:"4-construire-et-lancer-le-conteneur",level:2},{value:"Construire l\u2019image Docker",id:"construire-limage-docker",level:3},{value:"Lancer le conteneur",id:"lancer-le-conteneur",level:3},{value:"5. G\xe9rer les variables d\u2019environnement",id:"5-g\xe9rer-les-variables-denvironnement",level:2},{value:"6. Optimisations avanc\xe9es",id:"6-optimisations-avanc\xe9es",level:2},{value:"Multistage build pour r\xe9duire la taille",id:"multistage-build-pour-r\xe9duire-la-taille",level:3},{value:"Utiliser <code>next export</code> (optionnel)",id:"utiliser-next-export-optionnel",level:3},{value:"7. D\xe9ploiement sur une plateforme cloud",id:"7-d\xe9ploiement-sur-une-plateforme-cloud",level:2},{value:"Exemples de plateformes compatibles Docker",id:"exemples-de-plateformes-compatibles-docker",level:3},{value:"R\xe9f\xe9rences",id:"r\xe9f\xe9rences",level:2},{value:"8. R\xe9sum\xe9",id:"8-r\xe9sum\xe9",level:2},{value:"Annexes",id:"annexes",level:2},{value:"Exemple <code>.dockerignore</code>",id:"exemple-dockerignore",level:3}],s={toc:u},c="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"04---d\xe9ployer-une-application-nextjs-avec-docker"},"04 - D\xe9ployer une application Next.js avec Docker"),(0,a.kt)("p",null,"Ce chapitre explique comment containeriser et d\xe9ployer une application Next.js \xe0 l\u2019aide de Docker. Tu apprendras \xe0 cr\xe9er une image Docker optimis\xe9e, \xe0 lancer un conteneur et \xe0 pr\xe9parer ton application pour la production."),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"objectifs-dapprentissage"},"Objectifs d'apprentissage"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Comprendre les avantages du d\xe9ploiement avec Docker"),(0,a.kt)("li",{parentName:"ul"},"Cr\xe9er un Dockerfile performant pour Next.js"),(0,a.kt)("li",{parentName:"ul"},"Construire et lancer un conteneur Docker"),(0,a.kt)("li",{parentName:"ul"},"G\xe9rer l\u2019environnement de production"),(0,a.kt)("li",{parentName:"ul"},"Optimiser l\u2019image et le workflow Docker")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"voir-aussi"},"Voir aussi"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"../00-plan-du-parcours.md")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"./01-methodes-rendu-nextjs.md")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"./02-nextjs-seo.md")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"./03-metadata-api.md")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"../module-4-backend-api/01-nodejs-api-rest.md"))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"1-pourquoi-docker-pour-nextjs-"},"1. Pourquoi Docker pour Next.js ?"),(0,a.kt)("p",null,"Docker permet de cr\xe9er un environnement isol\xe9 et reproductible, garantissant que ton application Next.js fonctionne de mani\xe8re identique partout : local, staging, production."),(0,a.kt)("h3",{id:"avantages-"},"Avantages :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Portabilit\xe9 : m\xeame image partout"),(0,a.kt)("li",{parentName:"ul"},"Isolation des d\xe9pendances"),(0,a.kt)("li",{parentName:"ul"},"Facilit\xe9 d\u2019int\xe9gration en CI/CD"),(0,a.kt)("li",{parentName:"ul"},"Contr\xf4le pr\xe9cis de l\u2019environnement (Node.js, variables, etc.)")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"2-pr\xe9parer-ton-application-nextjs"},"2. Pr\xe9parer ton application Next.js"),(0,a.kt)("p",null,"Assure-toi que ton projet Next.js est pr\xeat pour la production :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"D\xe9finir la commande de build : ",(0,a.kt)("inlineCode",{parentName:"li"},"next build")),(0,a.kt)("li",{parentName:"ul"},"D\xe9finir la commande de d\xe9marrage : ",(0,a.kt)("inlineCode",{parentName:"li"},"next start")," (serveur Next.js en mode production)"),(0,a.kt)("li",{parentName:"ul"},"G\xe9rer les variables d\u2019environnement dans un fichier ",(0,a.kt)("inlineCode",{parentName:"li"},".env.production")," ou via Docker")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"3-dockerfile--cr\xe9er-limage-docker"},"3. Dockerfile : cr\xe9er l\u2019image Docker"),(0,a.kt)("p",null,"Voici un Dockerfile simple et efficace pour une app Next.js :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},'# \xc9tape 1 : builder l\'application\nFROM node:18-alpine AS builder\n\nWORKDIR /app\n\n# Copier les fichiers package.json et package-lock.json (ou yarn.lock)\nCOPY package*.json ./\n\n# Installer les d\xe9pendances\nRUN npm ci\n\n# Copier le reste du code source\nCOPY . .\n\n# Construire l\'app Next.js\nRUN npm run build\n\n# \xc9tape 2 : image finale l\xe9g\xe8re\nFROM node:18-alpine AS runner\n\nWORKDIR /app\n\n# Copier uniquement les fichiers n\xe9cessaires pour la prod\nCOPY --from=builder /app/package*.json ./\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/.next ./.next\nCOPY --from=builder /app/public ./public\n\n# Exposer le port sur lequel Next.js va \xe9couter\nEXPOSE 3000\n\n# Lancer l\'application en mode production\nCMD ["npm", "start"]\n')),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"4-construire-et-lancer-le-conteneur"},"4. Construire et lancer le conteneur"),(0,a.kt)("h3",{id:"construire-limage-docker"},"Construire l\u2019image Docker"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t monapp-nextjs .\n")),(0,a.kt)("h3",{id:"lancer-le-conteneur"},"Lancer le conteneur"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -p 3000:3000 monapp-nextjs\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"L\u2019app est accessible sur ",(0,a.kt)("a",{parentName:"li",href:"http://localhost:3000"},"http://localhost:3000"))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"5-g\xe9rer-les-variables-denvironnement"},"5. G\xe9rer les variables d\u2019environnement"),(0,a.kt)("p",null,"Pour passer des variables (API keys, configs) en production, plusieurs options :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Utiliser un fichier ",(0,a.kt)("inlineCode",{parentName:"li"},".env.production")," dans ton projet"),(0,a.kt)("li",{parentName:"ul"},"Passer les variables via la ligne de commande Docker :")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -p 3000:3000 -e NEXT_PUBLIC_API_URL=https://api.monsite.com monapp-nextjs\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Utiliser un fichier ",(0,a.kt)("inlineCode",{parentName:"li"},".env")," externe avec ",(0,a.kt)("inlineCode",{parentName:"li"},"--env-file"))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"6-optimisations-avanc\xe9es"},"6. Optimisations avanc\xe9es"),(0,a.kt)("h3",{id:"multistage-build-pour-r\xe9duire-la-taille"},"Multistage build pour r\xe9duire la taille"),(0,a.kt)("p",null,"Le Dockerfile ci-dessus utilise d\xe9j\xe0 un multistage build. Cela permet de ne copier que ce qui est n\xe9cessaire dans l\u2019image finale, r\xe9duisant sa taille."),(0,a.kt)("h3",{id:"utiliser-next-export-optionnel"},"Utiliser ",(0,a.kt)("inlineCode",{parentName:"h3"},"next export")," (optionnel)"),(0,a.kt)("p",null,"Si tu as une app statique (SSG), tu peux g\xe9n\xe9rer une version export\xe9e :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm run export\n")),(0,a.kt)("p",null,"Puis servir le dossier ",(0,a.kt)("inlineCode",{parentName:"p"},"out")," avec un serveur HTTP l\xe9ger (ex: ",(0,a.kt)("inlineCode",{parentName:"p"},"nginx"),")."),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"7-d\xe9ploiement-sur-une-plateforme-cloud"},"7. D\xe9ploiement sur une plateforme cloud"),(0,a.kt)("h3",{id:"exemples-de-plateformes-compatibles-docker"},"Exemples de plateformes compatibles Docker"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"AWS ECS / EKS")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Google Cloud Run")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Azure Container Instances")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"DigitalOcean App Platform")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Heroku (avec buildpacks Docker)"))),(0,a.kt)("p",null,"Ces plateformes permettent d\u2019importer l\u2019image Docker et de lancer ton application facilement."),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"r\xe9f\xe9rences"},"R\xe9f\xe9rences"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Next.js Docs \u2013 D\xe9ploiement: ",(0,a.kt)("a",{parentName:"li",href:"https://nextjs.org/docs"},"https://nextjs.org/docs")),(0,a.kt)("li",{parentName:"ul"},"Docker Docs \u2013 Guides: ",(0,a.kt)("a",{parentName:"li",href:"https://docs.docker.com/"},"https://docs.docker.com/")),(0,a.kt)("li",{parentName:"ul"},"Next.js Example \u2013 with-docker: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/vercel/next.js/tree/canary/examples/with-docker"},"https://github.com/vercel/next.js/tree/canary/examples/with-docker")),(0,a.kt)("li",{parentName:"ul"},"Chakra UI: ",(0,a.kt)("a",{parentName:"li",href:"https://chakra-ui.com/"},"https://chakra-ui.com/")),(0,a.kt)("li",{parentName:"ul"},"shadcn/ui: ",(0,a.kt)("a",{parentName:"li",href:"https://ui.shadcn.com/"},"https://ui.shadcn.com/"))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"8-r\xe9sum\xe9"},"8. R\xe9sum\xe9"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"\xc9tape"),(0,a.kt)("th",{parentName:"tr",align:null},"Commandes cl\xe9s"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Pr\xe9parer le projet"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"npm run build"),", variables d\u2019env")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cr\xe9er l\u2019image Docker"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"docker build -t monapp-nextjs ."))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Lancer le conteneur"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"docker run -p 3000:3000 monapp-nextjs"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Variables d\u2019env"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"-e VAR=valeur")," ou ",(0,a.kt)("inlineCode",{parentName:"td"},"--env-file .env"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9ployer en cloud"),(0,a.kt)("td",{parentName:"tr",align:null},"Importer l\u2019image Docker dans la plateforme")))),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"annexes"},"Annexes"),(0,a.kt)("h3",{id:"exemple-dockerignore"},"Exemple ",(0,a.kt)("inlineCode",{parentName:"h3"},".dockerignore")),(0,a.kt)("p",null,"Pour \xe9viter de copier les fichiers inutiles dans l\u2019image :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"node_modules\nnpm-debug.log\nDockerfile\n.dockerignore\n.git\n.gitignore\n.env\n")))}d.isMDXComponent=!0}}]);